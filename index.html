<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Ludo Game | Developed by Rayhan</title>
    <style>
        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            overflow: hidden;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .ludo-icon {
            width: 150px;
            height: 150px;
            margin-bottom: 30px;
            animation: bounce 2s infinite;
        }

        .loading-text {
            color: white;
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }

        .loading-bar {
            width: 300px;
            height: 10px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .loading-progress {
            height: 100%;
            width: 0%;
            background-color: white;
            animation: loading 3s forwards;
        }

        .developer-text {
            color: white;
            font-size: 18px;
            font-style: italic;
            margin-top: 20px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }

        @keyframes loading {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        /* Home Screen */
        .home-screen {
            display: none;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            flex-direction: column;
            align-items: center;
        }

        .home-screen.active {
            display: flex;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .game-title {
            font-size: 3rem;
            color: #4a4a4a;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .developer-name {
            font-size: 1.2rem;
            color: #6e8efb;
            font-style: italic;
            margin-bottom: 30px;
        }

        .game-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
        }

        .option-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .option-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .game-container {
            display: none;
            width: 100%;
            height: 100vh;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
        }

        .game-container.active {
            display: flex;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
        }

        .game-info {
            display: flex;
            gap: 20px;
        }

        .info-box {
            background-color: white;
            padding: 10px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .player-turn {
            font-weight: bold;
            color: #6e8efb;
        }

        .dice-container {
            background-color: white;
            width: 60px;
            height: 60px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .dice-container:hover {
            transform: scale(1.05);
        }

        .dice-value {
            font-size: 24px;
            font-weight: bold;
        }

        .ludo-board {
            width: 90vmin;
            height: 90vmin;
            max-width: 600px;
            max-height: 600px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: relative;
            display: grid;
            grid-template-columns: repeat(15, 1fr);
            grid-template-rows: repeat(15, 1fr);
            overflow: hidden;
        }

        .cell {
            border: 1px solid rgba(0, 0, 0, 0.05);
            position: relative;
        }

        /* Board colors */
        .red-area {
            background-color: #ff6b6b;
            grid-column: 1 / 6;
            grid-row: 1 / 6;
        }

        .green-area {
            background-color: #51cf66;
            grid-column: 10 / 15;
            grid-row: 1 / 6;
        }

        .yellow-area {
            background-color: #fcc419;
            grid-column: 1 / 6;
            grid-row: 10 / 15;
        }

        .blue-area {
            background-color: #339af0;
            grid-column: 10 / 15;
            grid-row: 10 / 15;
        }

        .center-area {
            background-color: #fff;
            grid-column: 6 / 10;
            grid-row: 6 / 10;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .star {
            width: 80%;
            height: 80%;
            background-color: #f8f9fa;
            clip-path: polygon(
                50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%
            );
        }

        /* Path cells */
        .red-path {
            background-color: #ffc9c9;
        }

        .green-path {
            background-color: #b2f2bb;
        }

        .yellow-path {
            background-color: #ffec99;
        }

        .blue-path {
            background-color: #a5d8ff;
        }

        /* Safe cells */
        .safe-cell {
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .safe-cell::after {
            content: "";
            width: 50%;
            height: 50%;
            background-color: #495057;
            border-radius: 50%;
        }

        /* Home cells */
        .home-cell {
            border-radius: 50%;
        }

        .red-home {
            background-color: #ff8787;
        }

        .green-home {
            background-color: #69db7c;
        }

        .yellow-home {
            background-color: #ffd43b;
        }

        .blue-home {
            background-color: #4dabf7;
        }

        /* Tokens */
        .token {
            width: 70%;
            height: 70%;
            border-radius: 50%;
            position: absolute;
            top: 15%;
            left: 15%;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
        }

        .token:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .token.red {
            background-color: #fa5252;
            border: 2px solid #e03131;
        }

        .token.green {
            background-color: #40c057;
            border: 2px solid #2f9e44;
        }

        .token.yellow {
            background-color: #fab005;
            border: 2px solid #f08c00;
        }

        .token.blue {
            background-color: #339af0;
            border: 2px solid #1971c2;
        }

        .token.highlight {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 0, 0, 0.2); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(0, 0, 0, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 0, 0, 0); }
        }

        /* Game controls */
        .game-controls {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .control-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .game-title {
                font-size: 2rem;
            }
            
            .developer-name {
                font-size: 1rem;
            }
            
            .option-btn {
                padding: 12px 24px;
                font-size: 1rem;
            }
            
            .game-header {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            
            .game-info {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen">
        <img src="https://cdn-icons-png.flaticon.com/512/2693/2693477.png" alt="Ludo Icon" class="ludo-icon">
        <div class="loading-text">Loading Professional Ludo Game</div>
        <div class="loading-bar">
            <div class="loading-progress"></div>
        </div>
        <div class="developer-text">Developed by Rayhan</div>
    </div>

    <!-- Home Screen -->
    <div class="home-screen">
        <div class="header">
            <h1 class="game-title">Professional Ludo</h1>
            <div class="developer-name">Developed by Rayhan</div>
        </div>
        
        <div class="game-options">
            <button class="option-btn" id="singlePlayerBtn">Single Player</button>
            <button class="option-btn" id="multiplayerBtn">Multiplayer</button>
            <button class="option-btn" id="howToPlayBtn">How to Play</button>
            <button class="option-btn" id="settingsBtn">Settings</button>
        </div>
    </div>

    <!-- Game Container -->
    <div class="game-container">
        <div class="game-header">
            <div class="game-info">
                <div class="info-box">
                    <span>Player:</span>
                    <span class="player-turn">Red</span>
                </div>
                <div class="info-box">
                    <span>Rolls:</span>
                    <span class="rolls-count">0</span>
                </div>
            </div>
            
            <div class="dice-container" id="dice">
                <div class="dice-value">0</div>
            </div>
        </div>
        
        <div class="ludo-board" id="board">
            <!-- Board will be generated by JavaScript -->
        </div>
        
        <div class="game-controls">
            <button class="control-btn" id="newGameBtn">New Game</button>
            <button class="control-btn" id="homeBtn">Home</button>
            <button class="control-btn" id="soundBtn">Sound: ON</button>
        </div>
    </div>

    <script>
        // Game Variables
        let currentPlayer = 'red';
        let diceValue = 0;
        let rollsCount = 0;
        let soundEnabled = true;
        let gameStarted = false;
        let players = {
            red: { tokens: [], homeCount: 0 },
            green: { tokens: [], homeCount: 0 },
            yellow: { tokens: [], homeCount: 0 },
            blue: { tokens: [], homeCount: 0 }
        };
        
        // DOM Elements
        const loadingScreen = document.querySelector('.loading-screen');
        const homeScreen = document.querySelector('.home-screen');
        const gameContainer = document.querySelector('.game-container');
        const playerTurnDisplay = document.querySelector('.player-turn');
        const rollsCountDisplay = document.querySelector('.rolls-count');
        const diceContainer = document.getElementById('dice');
        const diceValueDisplay = document.querySelector('.dice-value');
        const board = document.getElementById('board');
        const soundBtn = document.getElementById('soundBtn');
        const homeBtn = document.getElementById('homeBtn');
        const newGameBtn = document.getElementById('newGameBtn');
        const singlePlayerBtn = document.getElementById('singlePlayerBtn');
        const multiplayerBtn = document.getElementById('multiplayerBtn');
        const howToPlayBtn = document.getElementById('howToPlayBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        
        // Initialize the game
        function initGame() {
            // Hide loading screen after 3 seconds
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
                homeScreen.classList.add('active');
                
                // Initialize home screen
                initHomeScreen();
            }, 3000);
        }
        
        // Initialize home screen
        function initHomeScreen() {
            singlePlayerBtn.addEventListener('click', () => {
                startGame('single');
            });
            
            multiplayerBtn.addEventListener('click', () => {
                startGame('multi');
            });
            
            howToPlayBtn.addEventListener('click', () => {
                alert("How to Play Ludo:\n\n1. Each player takes turns to roll the dice.\n2. On a 6, you can move a token out of your base or move any token.\n3. Move your tokens around the board according to the dice roll.\n4. If you land on an opponent's token, it gets sent back to their base.\n5. The first player to get all 4 tokens to the home area wins!");
            });
            
            settingsBtn.addEventListener('click', () => {
                soundEnabled = !soundEnabled;
                soundBtn.textContent = `Sound: ${soundEnabled ? 'ON' : 'OFF'}`;
                alert(`Sound ${soundEnabled ? 'enabled' : 'disabled'}`);
            });
            
            homeBtn.addEventListener('click', () => {
                gameContainer.classList.remove('active');
                homeScreen.classList.add('active');
                resetGame();
            });
            
            newGameBtn.addEventListener('click', () => {
                resetGame();
            });
            
            soundBtn.addEventListener('click', () => {
                soundEnabled = !soundEnabled;
                soundBtn.textContent = `Sound: ${soundEnabled ? 'ON' : 'OFF'}`;
                if (soundEnabled) playSound('click');
            });
        }
        
        // Start the game
        function startGame(mode) {
            homeScreen.classList.remove('active');
            gameContainer.classList.add('active');
            
            // Initialize board
            createBoard();
            initializeTokens();
            
            // Set up game state
            currentPlayer = 'red';
            playerTurnDisplay.textContent = 'Red';
            playerTurnDisplay.style.color = '#fa5252';
            rollsCount = 0;
            rollsCountDisplay.textContent = rollsCount;
            gameStarted = true;
            
            if (soundEnabled) playSound('start');
        }
        
        // Create the Ludo board
        function createBoard() {
            board.innerHTML = '';
            
            // Create 15x15 grid
            for (let row = 0; row < 15; row++) {
                for (let col = 0; col < 15; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    // Set cell IDs for path tracking
                    cell.id = `cell-${row}-${col}`;
                    
                    // Color areas
                    if (row < 5 && col < 5) {
                        cell.classList.add('red-area');
                    } else if (row < 5 && col >= 10) {
                        cell.classList.add('green-area');
                    } else if (row >= 10 && col < 5) {
                        cell.classList.add('yellow-area');
                    } else if (row >= 10 && col >= 10) {
                        cell.classList.add('blue-area');
                    } else if (row >= 6 && row < 9 && col >= 6 && col < 9) {
                        cell.classList.add('center-area');
                        const star = document.createElement('div');
                        star.className = 'star';
                        cell.appendChild(star);
                    }
                    
                    // Path cells
                    setPathCells(cell, row, col);
                    
                    // Safe cells
                    setSafeCells(cell, row, col);
                    
                    // Home cells
                    setHomeCells(cell, row, col);
                    
                    board.appendChild(cell);
                }
            }
            
            // Set up dice event
            diceContainer.addEventListener('click', rollDice);
        }
        
        // Set path cells
        function setPathCells(cell, row, col) {
            // Red path (top left to top right)
            if ((row === 4 && col >= 5 && col <= 9) || 
                (col === 5 && row >= 5 && row <= 9)) {
                cell.classList.add('red-path');
                cell.dataset.path = 'red';
                cell.dataset.pathIndex = row === 4 ? col - 5 : 5 + (9 - row);
            }
            
            // Green path (top right to bottom right)
            if ((col === 9 && row >= 5 && row <= 9) || 
                (row === 5 && col >= 5 && col <= 9)) {
                cell.classList.add('green-path');
                cell.dataset.path = 'green';
                cell.dataset.pathIndex = col === 9 ? 5 + (row - 5) : 5 + (9 - col);
            }
            
            // Yellow path (bottom left to top left)
            if ((row === 9 && col >= 5 && col <= 9) || 
                (col === 6 && row >= 5 && row <= 9)) {
                cell.classList.add('yellow-path');
                cell.dataset.path = 'yellow';
                cell.dataset.pathIndex = row === 9 ? 5 + (9 - col) : 5 + (row - 5);
            }
            
            // Blue path (bottom right to bottom left)
            if ((col === 5 && row >= 5 && row <= 9) || 
                (row === 10 && col >= 5 && col <= 9)) {
                cell.classList.add('blue-path');
                cell.dataset.path = 'blue';
                cell.dataset.pathIndex = col === 5 ? 5 + (9 - row) : 5 + (col - 5);
            }
        }
        
        // Set safe cells
        function setSafeCells(cell, row, col) {
            const safeCells = [
                [6, 1], [1, 6], [6, 13], [1, 8],
                [8, 1], [13, 6], [8, 13], [13, 8]
            ];
            
            for (const [r, c] of safeCells) {
                if (row === r && col === c) {
                    cell.classList.add('safe-cell');
                    break;
                }
            }
        }
        
        // Set home cells
        function setHomeCells(cell, row, col) {
            // Red home cells
            if ((row === 1 && col === 1) || (row === 1 && col === 3) || 
                (row === 3 && col === 1) || (row === 3 && col === 3)) {
                cell.classList.add('home-cell', 'red-home');
                cell.dataset.home = 'red';
            }
            
            // Green home cells
            if ((row === 1 && col === 11) || (row === 1 && col === 13) || 
                (row === 3 && col === 11) || (row === 3 && col === 13)) {
                cell.classList.add('home-cell', 'green-home');
                cell.dataset.home = 'green';
            }
            
            // Yellow home cells
            if ((row === 11 && col === 1) || (row === 11 && col === 3) || 
                (row === 13 && col === 1) || (row === 13 && col === 3)) {
                cell.classList.add('home-cell', 'yellow-home');
                cell.dataset.home = 'yellow';
            }
            
            // Blue home cells
            if ((row === 11 && col === 11) || (row === 11 && col === 13) || 
                (row === 13 && col === 11) || (row === 13 && col === 13)) {
                cell.classList.add('home-cell', 'blue-home');
                cell.dataset.home = 'blue';
            }
        }
        
        // Initialize tokens
        function initializeTokens() {
            // Clear previous tokens
            players.red.tokens = [];
            players.green.tokens = [];
            players.yellow.tokens = [];
            players.blue.tokens = [];
            
            // Create tokens for each player
            for (let i = 0; i < 4; i++) {
                createToken('red', i);
                createToken('green', i);
                createToken('yellow', i);
                createToken('blue', i);
            }
        }
        
        // Create a token
        function createToken(color, index) {
            const token = document.createElement('div');
            token.className = `token ${color}`;
            token.dataset.color = color;
            token.dataset.index = index;
            token.dataset.position = 'base';
            token.dataset.pathIndex = -1;
            
            // Find home cell for this token
            const homeCells = document.querySelectorAll(`[data-home="${color}"]`);
            const homeCell = homeCells[index];
            homeCell.appendChild(token);
            
            // Add click event
            token.addEventListener('click', () => handleTokenClick(token));
            
            // Store token reference
            players[color].tokens.push({
                element: token,
                position: 'base',
                pathIndex: -1
            });
        }
        
        // Roll the dice
        function rollDice() {
            if (!gameStarted) return;
            
            // Only allow rolling if it's the player's turn
            if (currentPlayer !== 'red') return; // In single player, only red is human
            
            // Disable dice during animation
            diceContainer.style.pointerEvents = 'none';
            
            // Animate dice
            let rolls = 0;
            const maxRolls = 10;
            const rollInterval = setInterval(() => {
                diceValue = Math.floor(Math.random() * 6) + 1;
                diceValueDisplay.textContent = diceValue;
                rolls++;
                
                if (rolls >= maxRolls) {
                    clearInterval(rollInterval);
                    diceContainer.style.pointerEvents = 'auto';
                    rollsCount++;
                    rollsCountDisplay.textContent = rollsCount;
                    
                    // Check for valid moves
                    const hasValidMove = checkValidMoves();
                    
                    if (!hasValidMove && diceValue !== 6) {
                        setTimeout(() => {
                            alert("No valid moves! Next player's turn.");
                            nextPlayer();
                        }, 500);
                    }
                    
                    if (soundEnabled) playSound('dice');
                }
            }, 100);
        }
        
        // Check if player has any valid moves
        function checkValidMoves() {
            const playerTokens = players[currentPlayer].tokens;
            let hasValidMove = false;
            
            // Highlight movable tokens
            playerTokens.forEach(token => {
                if (canMoveToken(token)) {
                    token.element.classList.add('highlight');
                    hasValidMove = true;
                } else {
                    token.element.classList.remove('highlight');
                }
            });
            
            return hasValidMove;
        }
        
        // Check if a token can move
        function canMoveToken(token) {
            // If token is in base, can only move out on a 6
            if (token.position === 'base' && diceValue === 6) {
                return true;
            }
            
            // If token is on path
            if (token.position === 'path') {
                const newPathIndex = token.pathIndex + diceValue;
                
                // Check if move would go beyond home
                if (newPathIndex > 56) {
                    return false;
                }
                
                return true;
            }
            
            // If token is in home stretch
            if (token.position === 'home-stretch') {
                const newPathIndex = token.pathIndex + diceValue;
                
                // Check if move would go beyond home
                if (newPathIndex > 6) {
                    return false;
                }
                
                return true;
            }
            
            return false;
        }
        
        // Handle token click
        function handleTokenClick(token) {
            if (!gameStarted || currentPlayer !== 'red') return;
            
            const color = token.dataset.color;
            const index = parseInt(token.dataset.index);
            const tokenData = players[color].tokens[index];
            
            // Check if token can move
            if (!canMoveToken(tokenData)) return;
            
            // Move the token
            moveToken(tokenData);
            
            // Remove highlights
            players[currentPlayer].tokens.forEach(t => {
                t.element.classList.remove('highlight');
            });
            
            // If not a 6, move to next player
            if (diceValue !== 6) {
                setTimeout(() => {
                    nextPlayer();
                }, 1000);
            }
        }
        
        // Move a token
        function moveToken(token) {
            // If token is in base, move to start
            if (token.position === 'base') {
                moveTokenToStart(token);
                return;
            }
            
            // If token is on path
            if (token.position === 'path') {
                const newPathIndex = token.pathIndex + diceValue;
                
                // Check if entering home stretch
                if (newPathIndex === 51) {
                    moveTokenToHomeStretch(token);
                    return;
                }
                
                // Check if moving beyond home stretch entry
                if (newPathIndex > 51) {
                    // Can't move beyond home stretch entry
                    return;
                }
                
                // Move along path
                moveTokenAlongPath(token, newPathIndex);
                return;
            }
            
            // If token is in home stretch
            if (token.position === 'home-stretch') {
                const newPathIndex = token.pathIndex + diceValue;
                
                // Check if reached home
                if (newPathIndex === 6) {
                    moveTokenToHome(token);
                    return;
                }
                
                // Check if moving beyond home
                if (newPathIndex > 6) {
                    // Can't move beyond home
                    return;
                }
                
                // Move along home stretch
                moveTokenInHomeStretch(token, newPathIndex);
                return;
            }
        }
        
        // Move token from base to start
        function moveTokenToStart(token) {
            // Find start cell for this color
            let startCell;
            
            if (token.element.dataset.color === 'red') {
                startCell = document.querySelector('[data-path="red"][data-path-index="0"]');
            } else if (token.element.dataset.color === 'green') {
                startCell = document.querySelector('[data-path="green"][data-path-index="0"]');
            } else if (token.element.dataset.color === 'yellow') {
                startCell = document.querySelector('[data-path="yellow"][data-path-index="0"]');
            } else if (token.element.dataset.color === 'blue') {
                startCell = document.querySelector('[data-path="blue"][data-path-index="0"]');
            }
            
            // Move token to start cell
            startCell.appendChild(token.element);
            token.position = 'path';
            token.pathIndex = 0;
            
            if (soundEnabled) playSound('move');
        }
        
        // Move token along path
        function moveTokenAlongPath(token, newPathIndex) {
            // Check for opponent tokens to capture
            const currentPathCell = document.querySelector(
                `[data-path="${token.element.dataset.color}"][data-path-index="${token.pathIndex}"]`
            );
            
            const newPathCell = document.querySelector(
                `[data-path="${token.element.dataset.color}"][data-path-index="${newPathIndex}"]`
            );
            
            // Check if new cell has opponent tokens
            const opponentTokens = Array.from(newPathCell.children).filter(
                child => child.classList.contains('token') && 
                       !child.classList.contains(token.element.dataset.color) &&
                       !newPathCell.classList.contains('safe-cell')
            );
            
            // Send opponent tokens back to base
            opponentTokens.forEach(opponentToken => {
                const opponentColor = opponentToken.dataset.color;
                const opponentIndex = parseInt(opponentToken.dataset.index);
                const opponentData = players[opponentColor].tokens[opponentIndex];
                
                // Find home cell for this token
                const homeCells = document.querySelectorAll(`[data-home="${opponentColor}"]`);
                const homeCell = homeCells[opponentIndex];
                
                // Move token back to base
                homeCell.appendChild(opponentToken);
                opponentData.position = 'base';
                opponentData.pathIndex = -1;
                
                if (soundEnabled) playSound('capture');
            });
            
            // Move token to new cell
            newPathCell.appendChild(token.element);
            token.pathIndex = newPathIndex;
            
            if (soundEnabled) playSound('move');
        }
        
        // Move token to home stretch
        function moveTokenToHomeStretch(token) {
            // Find home stretch start cell for this color
            let homeStretchCell;
            
            if (token.element.dataset.color === 'red') {
                homeStretchCell = document.querySelector('[data-path="red"][data-path-index="51"]');
            } else if (token.element.dataset.color === 'green') {
                homeStretchCell = document.querySelector('[data-path="green"][data-path-index="51"]');
            } else if (token.element.dataset.color === 'yellow') {
                homeStretchCell = document.querySelector('[data-path="yellow"][data-path-index="51"]');
            } else if (token.element.dataset.color === 'blue') {
                homeStretchCell = document.querySelector('[data-path="blue"][data-path-index="51"]');
            }
            
            // Move token to home stretch
            homeStretchCell.appendChild(token.element);
            token.position = 'home-stretch';
            token.pathIndex = 0;
            
            if (soundEnabled) playSound('move');
        }
        
        // Move token in home stretch
        function moveTokenInHomeStretch(token, newPathIndex) {
            // Find home stretch cell for this index and color
            let homeStretchCell;
            
            if (token.element.dataset.color === 'red') {
                homeStretchCell = document.querySelector(`[data-path="red"][data-path-index="${51 + newPathIndex}"]`);
            } else if (token.element.dataset.color === 'green') {
                homeStretchCell = document.querySelector(`[data-path="green"][data-path-index="${51 + newPathIndex}"]`);
            } else if (token.element.dataset.color === 'yellow') {
                homeStretchCell = document.querySelector(`[data-path="yellow"][data-path-index="${51 + newPathIndex}"]`);
            } else if (token.element.dataset.color === 'blue') {
                homeStretchCell = document.querySelector(`[data-path="blue"][data-path-index="${51 + newPathIndex}"]`);
            }
            
            // Move token to new home stretch position
            homeStretchCell.appendChild(token.element);
            token.pathIndex = newPathIndex;
            
            if (soundEnabled) playSound('move');
        }
        
        // Move token to home
        function moveTokenToHome(token) {
            const color = token.element.dataset.color;
            const index = players[color].homeCount;
            
            // Find home cell for this token
            const homeCells = document.querySelectorAll(`[data-home="${color}"]`);
            const homeCell = homeCells[index];
            
            // Move token to home
            homeCell.appendChild(token.element);
            token.position = 'home';
            token.pathIndex = -1;
            players[color].homeCount++;
            
            // Check for win
            if (players[color].homeCount === 4) {
                setTimeout(() => {
                    alert(`${color.toUpperCase()} player wins!`);
                    resetGame();
                    homeScreen.classList.add('active');
                    gameContainer.classList.remove('active');
                }, 500);
            }
            
            if (soundEnabled) playSound('home');
        }
        
        // Move to next player
        function nextPlayer() {
            const playerOrder = ['red', 'green', 'yellow', 'blue'];
            const currentIndex = playerOrder.indexOf(currentPlayer);
            const nextIndex = (currentIndex + 1) % 4;
            currentPlayer = playerOrder[nextIndex];
            
            // Update UI
            playerTurnDisplay.textContent = currentPlayer.charAt(0).toUpperCase() + currentPlayer.slice(1);
            
            switch (currentPlayer) {
                case 'red':
                    playerTurnDisplay.style.color = '#fa5252';
                    break;
                case 'green':
                    playerTurnDisplay.style.color = '#40c057';
                    break;
                case 'yellow':
                    playerTurnDisplay.style.color = '#fab005';
                    break;
                case 'blue':
                    playerTurnDisplay.style.color = '#339af0';
                    break;
            }
            
            // Reset dice
            diceValue = 0;
            diceValueDisplay.textContent = '0';
            
            // If single player mode, let AI play
            if (currentPlayer !== 'red') {
                setTimeout(() => {
                    aiPlay();
                }, 1000);
            }
        }
        
        // AI player logic
        function aiPlay() {
            // Roll dice
            diceValue = Math.floor(Math.random() * 6) + 1;
            diceValueDisplay.textContent = diceValue;
            rollsCount++;
            rollsCountDisplay.textContent = rollsCount;
            
            if (soundEnabled) playSound('dice');
            
            // Find movable tokens
            const movableTokens = players[currentPlayer].tokens.filter(canMoveToken);
            
            if (movableTokens.length === 0) {
                if (diceValue !== 6) {
                    setTimeout(() => {
                        nextPlayer();
                    }, 1000);
                } else {
                    // If rolled a 6 but no moves, try again
                    setTimeout(() => {
                        aiPlay();
                    }, 1000);
                }
                return;
            }
            
            // Choose a random movable token
            const randomIndex = Math.floor(Math.random() * movableTokens.length);
            const tokenToMove = movableTokens[randomIndex];
            
            // Move the token after a delay
            setTimeout(() => {
                moveToken(tokenToMove);
                
                // If not a 6, move to next player
                if (diceValue !== 6) {
                    setTimeout(() => {
                        nextPlayer();
                    }, 1000);
                } else {
                    // If rolled a 6, play again
                    setTimeout(() => {
                        aiPlay();
                    }, 1000);
                }
            }, 1000);
        }
        
        // Reset the game
        function resetGame() {
            gameStarted = false;
            currentPlayer = 'red';
            playerTurnDisplay.textContent = 'Red';
            playerTurnDisplay.style.color = '#fa5252';
            diceValue = 0;
            diceValueDisplay.textContent = '0';
            rollsCount = 0;
            rollsCountDisplay.textContent = '0';
            
            // Reset players
            players = {
                red: { tokens: [], homeCount: 0 },
                green: { tokens: [], homeCount: 0 },
                yellow: { tokens: [], homeCount: 0 },
                blue: { tokens: [], homeCount: 0 }
            };
            
            // Recreate board and tokens
            createBoard();
            initializeTokens();
        }
        
        // Play sound
        function playSound(type) {
            if (!soundEnabled) return;
            
            // In a real implementation, you would play actual sound files
            console.log(`Playing ${type} sound`);
        }
        
        // Initialize the game when page loads
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
